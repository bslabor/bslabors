<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¶€ì‚°ë…¸ë™ê¶Œìµì„¼í„° 2026ë…„ ìµœì €ì„ê¸ˆ ë§íˆê¸° ì±Œë¦°ì§€</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --text:#e5e7eb; --accent:#22d3ee; }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    body{margin:0;background:linear-gradient(180deg,#0b1020,#101827);color:var(--text);display:flex;min-height:100vh;align-items:center;justify-content:center;padding:24px}
    .wrap{width:100%;max-width:720px;background:var(--card);border:1px solid #1f2937;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:28px}
    h1{margin:0 0 6px;font-size:26px;font-weight:800;letter-spacing:-.2px;line-height:1.4}
    .sub{opacity:.9;margin-bottom:18px;line-height:1.6}
    .target{display:flex;gap:8px;align-items:baseline;margin:8px 0 18px}
    .target .num{font-size:36px;font-weight:800;color:var(--accent)}
    .screen{background:#0b1220;border:1px solid #1e293b;border-radius:14px;padding:16px;margin:12px 0 18px}
    .big{font-variant-numeric:tabular-nums;letter-spacing:1px;font-size:56px;font-weight:900}
    .label{opacity:.7;margin-top:6px}
    .bar{position:relative;height:12px;background:#0b1325;border:1px solid #1f2a40;border-radius:999px;margin:16px 0}
    .fill{position:absolute;inset:0 0 0 auto;width:0;background:linear-gradient(90deg,#2563eb,#22d3ee);border-radius:999px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .pill{background:#0c1428;border:1px solid #1f2a40;border-radius:999px;padding:8px 12px}
    button{all:unset;cursor:pointer;text-align:center;padding:14px 16px;border-radius:12px;border:1px solid #2b3548;background:#0f1a2f}
    button.primary{background:linear-gradient(180deg,#2563eb,#0ea5e9);border-color:#1e40af;color:#fff;font-weight:800}
    button.danger{border-color:#7f1d1d;background:#1a0f12}
    button:hover{filter:brightness(1.08)}
    .muted{opacity:.7}.success{color:#22d3ee}.warn{color:#fbbf24}
    .small{font-size:14px}.foot{opacity:.7;margin-top:14px}
    a{color:#93c5fd}

    /* ëª¨ë°”ì¼ ìµœì í™” */
    @media (max-width:480px){
      body{padding:16px}.wrap{padding:18px;border-radius:16px}
      h1{font-size:20px;line-height:1.35;margin-bottom:8px}
      .sub{font-size:14px;margin-bottom:14px}
      .target .num{font-size:28px}.screen{padding:12px}
      .big{font-size:36px;letter-spacing:.5px}.label{font-size:12px}
      .row{gap:8px}.pill{padding:6px 10px;font-size:12px}
      .grid{grid-template-columns:1fr 1fr;gap:8px}
      button{padding:14px 12px;font-size:16px;min-height:44px}
      #leaderboard{margin:16px auto;padding:12px} #leaderboard h3{font-size:16px}
      #leaderboard li{font-size:14px;line-height:1.5}
    }
    @media (min-width:481px) and (max-width:768px){
      h1{font-size:22px}.big{font-size:48px} button{min-height:44px}
    }
  </style>
</head>
<body>

  <!-- ===== ê²Œì„ í™”ë©´ ===== -->
  <div id="gameView" class="wrap">
    <h1>ë¶€ì‚°ë…¸ë™ê¶Œìµì„¼í„° 2026ë…„ ìµœì €ì„ê¸ˆ ë§íˆê¸° ì±Œë¦°ì§€</h1>
    <div class="sub">
      ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œê°„ì„ ë©ˆì¶”ì„¸ìš”! ëª©í‘œëŠ” 2026ë…„ ìµœì €ì„ê¸ˆ <b>10,320ì›</b>ì— ë§ì¶”ëŠ” ê²ƒ!<br>
      ë…¸ë™ì˜ ê°€ì¹˜ë¥¼ í•¨ê»˜ ê¸°ì–µí•˜ëŠ” ì¬ë¯¸ìˆëŠ” ë„ì „ì…ë‹ˆë‹¤.<br>
      ê²Œì„ í›„ì—ëŠ” ì•„ë˜ <b>"ê²°ê³¼ ë³µì‚¬"</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ í™”ë©´ì„ ìº¡ì²˜í•´ êµ¬ê¸€í¼ì— ì œì¶œí•´ì£¼ì„¸ìš”!
    </div>

    <div class="target">
      <div>ëª©í‘œê°’:</div>
      <div class="num" id="target">10,320 ms</div>
    </div>

    <div class="screen">
      <div class="big" id="timer">0 ms</div>
      <div class="label"><span id="status" class="muted">ëŒ€ê¸° ì¤‘</span></div>
      <div class="bar"><div class="fill" id="fill"></div></div>
      <div class="row">
        <span class="pill">ë‚´ ê¸°ë¡: <b id="score">-</b></span>
        <span class="pill">ì˜¤ì°¨: <b id="diff">-</b></span>
        <span class="pill">ìµœê³ ê¸°ë¡(ì˜¤ì°¨): <b id="best">-</b></span>
      </div>
    </div>

    <div class="grid">
      <button id="start" class="primary">ì‹œì‘</button>
      <button id="stop">ì •ì§€</button>
      <button id="reset" class="danger">ë¦¬ì…‹</button>
      <button id="copy">ê²°ê³¼ ë³µì‚¬</button>
    </div>

    <div class="foot small">
      íŒ: ì •ì§€ í›„ <b>ê²°ê³¼ ë³µì‚¬</b>ë¥¼ ëˆŒëŸ¬ ì ìˆ˜/ì˜¤ì°¨ë¥¼ ë¶™ì—¬ë„£ê³ , í™”ë©´ì„ ìº¡ì²˜í•´ êµ¬ê¸€í¼ì— ì œì¶œí•˜ì„¸ìš”.
    </div>
  </div>

  <!-- ===== ê²°ê³¼ í™”ë©´ ===== -->
  <div id="resultView" class="wrap" style="display:none">
    <h2 style="margin:0 0 8px;">ê²°ê³¼</h2>
    <div class="row" style="margin:8px 0 16px">
      <span class="pill">ë‚´ ê¸°ë¡: <b id="rScore">-</b></span>
      <span class="pill">ì˜¤ì°¨: <b id="rDiff">-</b></span>
    </div>
    <div id="leaderboard" style="max-width:520px;margin:12px 0 0;padding:16px 12px;border:1px solid #eee;border-radius:14px;">
      <h3 style="margin:0 0 8px;">ğŸŒ ê¸€ë¡œë²Œ ìˆœìœ„í‘œ (Top 10)</h3>
      <ol id="leaderboardList" style="margin:0;padding-left:20px;"></ol>
    </div>
    <div class="grid" style="margin-top:16px">
      <button id="retry" class="primary">ë‹¤ì‹œ ë„ì „</button>
      <button id="share">ê²°ê³¼ ë³µì‚¬</button>
    </div>
    <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
    <p style="margin-top:16px; font-size:14px; color:#e5e7eb; text-align:center; opacity:0.9;">
      ì´ í™”ë©´ì„ ìº¡ì²˜í•˜ê³ , <b>ê²°ê³¼ë³µì‚¬</b> ë²„íŠ¼ì„ ëˆŒëŸ¬ êµ¬ê¸€í¼ì— ì œì¶œí•´ì£¼ì„¸ìš”.
    </p>
  </div>

  <!-- ===== ë‹‰ë„¤ì„ ì˜¤ë²„ë ˆì´ ===== -->
  <div id="startOverlay" style="position:fixed;inset:0;background:#0008;display:flex;align-items:center;justify-content:center;z-index:9999;">
    <div style="background:#fff;padding:24px 20px;border-radius:14px;max-width:360px;width:90%;box-shadow:0 10px 30px #0003;">
      <h2 style="margin:0 0 12px;color:#111">ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
      <input id="nicknameInput" type="text" maxlength="16"
             style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:10px;font-size:16px">
      <!-- disabled ì œê±° + type="button" ì¶”ê°€ -->
      <button id="startBtn" type="button"
              style="margin-top:12px;width:100%;padding:10px 12px;border:0;border-radius:10px;background:#111;color:#fff;font-size:16px;cursor:not-allowed">
        ì‹œì‘í•˜ê¸°
      </button>
      <p style="color:#666;font-size:12px;margin-top:8px">í•œ ë²ˆë§Œ ì…ë ¥í•˜ë©´ ì €ì¥ë¼ìš”.</p>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const TARGET = 10320;
    const RATE_SECONDS = 30; // 30ì´ˆ ì¿¨ë‹¤ìš´ë§Œ
    const $ = s => document.querySelector(s);
    const fmt = n => Number(n).toLocaleString('ko-KR');

    // ìš”ì†Œ ì°¸ì¡°
    const elTimer=$("#timer"),elStatus=$("#status"),elFill=$("#fill"),
          elScore=$("#score"),elDiff=$("#diff"),elBest=$("#best"),elTarget=$("#target");
    elTarget.textContent=`${fmt(TARGET)} ms`;

    const gameView=document.getElementById('gameView'),
          resultView=document.getElementById('resultView'),
          rScore=document.getElementById('rScore'),rDiff=document.getElementById('rDiff');

    const startOverlay=document.getElementById('startOverlay'),
          nicknameInput=document.getElementById('nicknameInput'),
          startBtn=document.getElementById('startBtn');

    // Supabase ì—°ê²°
    const { createClient }=supabase;
    const SUPABASE_URL="https://uwlpasqxtnfnqrhwjbvo.supabase.co";
    const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3bHBhc3F4dG5mbnFyaHdqYnZvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4ODIzMTUsImV4cCI6MjA3MjQ1ODMxNX0.B25x8vutVM5_znvMkcbS8L-zjaYgtronVM0V-f8ef4Y";
    const sb=createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

    // ë‹‰ë„¤ì„ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
    function getNickname(){return localStorage.getItem('game_nickname')||''}
    function setNickname(n){localStorage.setItem('game_nickname',n)}

    // ì‹œì‘ ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ê°•ì œ ì„¸íŒ…
    startBtn.disabled = (nicknameInput.value.trim().length < 1);
    startBtn.style.cursor = startBtn.disabled ? 'not-allowed' : 'pointer';

    function revealOverlayIfNeeded(){
      const saved=getNickname();
      if(saved){nicknameInput.value=saved;startBtn.disabled=false;startBtn.style.cursor='pointer';}
      startOverlay.style.display='flex';
    }

    nicknameInput.addEventListener('input',()=>{
      const ok=nicknameInput.value.trim().length>=1;
      startBtn.disabled=!ok;
      startBtn.style.cursor=ok?'pointer':'not-allowed';
    });

    function startGame(){start();}
    startBtn.addEventListener('click',()=>{
      const n=nicknameInput.value.trim(); if(!n) return;
      setNickname(n);
      startOverlay.style.display='none';
      startGame();
    });

    revealOverlayIfNeeded();

    // ë‹‰ë„¤ì„ ì •ì œ
    function sanitizeName(n){
      n=(n||'').trim().slice(0,16).replace(/[^\p{L}\p{N}_-]/gu,''); // ê¸€ì/ìˆ«ì/_-ë§Œ
      return n||'ìµëª…';
    }

    // ì ìˆ˜ ì €ì¥(30ì´ˆ ì¿¨ë‹¤ìš´ í™•ì¸ + DB ì €ì¥)
    async function saveScore(score){
      const name=sanitizeName(getNickname()||'ìµëª…');
      const s=Math.max(0,Number(score)||0);

      try{
        // ìµœê·¼ ì œì¶œ ì‹œê°„ ì¡°íšŒ(ì¿¨ë‹¤ìš´)
        const { data: recentRows }=await sb.from('scores')
          .select('created_at').eq('name',name).order('created_at',{ascending:false}).limit(1);

        if(recentRows && recentRows.length>0){
          const lastAt=new Date(recentRows[0].created_at).getTime();
          const diffSec=Math.floor((Date.now()-lastAt)/1000);
          if(diffSec<RATE_SECONDS){
            alert(`ë„ˆë¬´ ë¹ ë¥´ê²Œ ì œì¶œí–ˆì–´ìš”. ${RATE_SECONDS-diffSec}ì´ˆ í›„ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`);
            return;
          }
        }

        const { error }=await sb.from('scores').insert({name,score:s});
        if(error){alert('ì œì¶œ ì œí•œì— ê±¸ë ¸ì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');console.error(error);return;}
      }catch(e){console.error(e);alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');return;}

      await renderLeaderboard();
    }

    // ê¸€ë¡œë²Œ ìˆœìœ„í‘œ
    async function renderLeaderboard(){
      const list=document.getElementById('leaderboardList'); if(!list) return;
      list.innerHTML='<li>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>';
      const { data,error }=await sb.from('scores')
        .select('name, score, created_at')
        .order('score',{ascending:false}).order('created_at',{ascending:true}).limit(10);
      if(error){list.innerHTML='<li>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</li>';return;}
      if(!data || data.length===0){list.innerHTML='<li>ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.</li>';return;}
      list.innerHTML='';
      data.forEach(row=>{
        const li=document.createElement('li');
        li.textContent=`${row.name} â€” ${row.score}`;
        list.appendChild(li);
      });
    }
    renderLeaderboard();

    // ===== ê²Œì„ ë¡œì§ =====
    let running=false,startTime=0,rafId=0,elapsed=0;
    let best=Number(localStorage.getItem("best_diff")||Infinity);
    function updateBest(diff){if(diff<best){best=diff;localStorage.setItem("best_diff",String(best))}elBest.textContent=(best===Infinity)?"-":`${fmt(best)} ms`;}
    updateBest(Infinity);

    function tick(){const now=performance.now();elapsed=Math.round(now-startTime);elTimer.textContent=`${fmt(elapsed)} ms`;const pct=Math.min(elapsed/(TARGET*2),1);elFill.style.width=`${pct*100}%`;rafId=requestAnimationFrame(tick);}

    function start(){if(running)return;running=true;startTime=performance.now();elStatus.textContent="ì¸¡ì • ì¤‘â€¦ ë©ˆì¶”ë ¤ë©´ [ì •ì§€]";elStatus.className="success";elScore.textContent="-";elDiff.textContent="-";cancelAnimationFrame(rafId);tick();}
    function stop(){if(!running)return;running=false;cancelAnimationFrame(rafId);const score=elapsed;const diff=Math.abs(score-TARGET);elScore.textContent=`${fmt(score)} ms`;elDiff.textContent=`${fmt(diff)} ms`;elStatus.textContent=(diff===0)?"í¼í™íŠ¸! ğŸ‘":"ê¸°ë¡ ê³ ì •. ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!";elStatus.className=(diff===0)?"success":"warn";updateBest(diff);const points=Math.max(0,20000-diff);saveScore(points);showResultView(score,diff);}
    function resetAll(){running=false;cancelAnimationFrame(rafId);elapsed=0;elTimer.textContent="0 ms";elFill.style.width="0%";elScore.textContent="-";elDiff.textContent="-";elStatus.textContent="ëŒ€ê¸° ì¤‘";elStatus.className="muted";}

    function showResultView(score,diff){rScore.textContent=`${fmt(score)} ms`;rDiff.textContent=`${fmt(diff)} ms`;gameView.style.display='none';resultView.style.display='block';resultView.scrollIntoView({behavior:'smooth',block:'start'});}
    function backToGame(){resultView.style.display='none';gameView.style.display='block';resetAll();}

    // ê²°ê³¼ ë³µì‚¬
    function copyResult(){
      let scoreTxt = rScore && rScore.textContent !== '-' ? rScore.textContent : elScore.textContent;
      let diffTxt  = rDiff  && rDiff.textContent  !== '-' ? rDiff.textContent  : elDiff.textContent;
      scoreTxt = scoreTxt || "0 ms"; diffTxt = diffTxt || "0 ms";
      const text = `10320 ì±Œë¦°ì§€ ê²°ê³¼\n- ê¸°ë¡: ${scoreTxt.replace(' ms','')} ms\n- ì˜¤ì°¨: ${diffTxt.replace(' ms','')} ms`;
      navigator.clipboard.writeText(text).then(()=>{
        alert("âœ… ê²°ê³¼ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í–ˆì–´ìš”. êµ¬ê¸€í¼ì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš”!");
      }).catch(err=>{
        console.error("Clipboard error:", err);
        alert("âš ï¸ ë³µì‚¬ ì‹¤íŒ¨! ì§ì ‘ ì„ íƒí•´ì„œ Ctrl+C í•´ì£¼ì„¸ìš”.");
      });
    }

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById("start").addEventListener("click",start);
    document.getElementById("stop").addEventListener("click",stop);
    document.getElementById("reset").addEventListener("click",resetAll);
    document.getElementById("copy").addEventListener("click",copyResult);
    document.getElementById("retry").addEventListener("click",backToGame);
    document.getElementById("share").addEventListener("click",copyResult);

    addEventListener("keydown",e=>{if(e.key==="s"||e.key==="S")start();if(e.key===" "||e.key==="Enter"){e.preventDefault();stop();}if(e.key==="r"||e.key==="R")resetAll();});
  </script>
</body>
</html>
